```{r}


#############################################################
#############################################################
############## Web Scrapping from Ycharts ###################
#############################################################
#############################################################


##################################
########### Packages #############
##################################

if (!require("rvest")) install.packages("rvest")
library(rvest) 
library(tidyverse)

#################################
# make a vector of ticker########
#################################

Companies <- read.csv2("DataBase/Companies.csv", sep = ";", header = TRUE, stringsAsFactors = FALSE)

Ticker <- Companies$Ticker

TickerTest <- c("AAPL", "FB")

#################################
#Address of the login webpage####
#################################


login<-"https://ycharts.com/login?next=%2Fdashboard%2F"

#create a web session with the desired login address
pgsession<-html_session(login)
pgform<-html_form(pgsession)[[1]]  #in this case the submit is the 2nd form
filled_form<-set_values(pgform, username ="joelkinif@msn.com", password="Loana1234")
submit_form(pgsession, filled_form)

#################################
#WebScrapping Function###########
#################################


Results_List <- lapply(TickerTest, function(x) {
  
  #go to the page
  link <- paste("https://ycharts.com/companies/", x, "/r_and_d_expense", sep = "")
  
  
  getdata <- function(link){
    
    page <- jump_to(pgsession, link)
    data <- html_nodes(page, "td")
  
    #converting the data to text
    data1 <- html_text(data)
  
    #tidy data
    data2 <- matrix(data1, ncol = 2, byrow = TRUE)
    data3 <- as.data.frame(data2)

  }
  
   #Map everything into a dataframe
  map_df(link, getdata) -> results

  # add an id column indicating which ticker
  results$Ticker <- x

  return(results)
  
})

#################################
# Results ########################
#################################

#now collapse the resulting list into one tidy df

Results <- bind_rows(Results_List)



```

