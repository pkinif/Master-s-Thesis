---
output: pdf_document
---
```{r}
if (!require("plm")) install.packages("plm")
library(plm)

# I dowload my DataBase with read.csv2
DB_ROA<-data.frame(read.csv2("DataBase/DataBase_010418.csv", sep = ";",stringsAsFactors=FALSE, header = TRUE ))
```


## Model 6

**Model 6 :** Both Green Performance and Green Initiative on ROA

\begin{equation}
ROA_{it+1}=\beta_{0} + \beta_{1} (EP_{it}) + \beta_{2} (CP_{it}) + \beta_{3} (WatP_{it}) + \beta_{4} (WasP_{it}) + \beta_{5} (GP_{it}) + \beta_{6} (SP_{it}) + \beta_{7} (ST_{it}) + \beta_{8} (AS_{it})+ (C_{it}) + \varepsilon_{it}
\label{M6}
\end{equation}


where :

* \(TobinsQ_{it+1}\) = a proxy for a firm's financial performance
* \(ROA_{it+1}\) = a proxy for a firm's financial performance
* \(EP_{it}\) = a proxy for a firm's energy productivity
* \(CP_{it}\) = a proxy for a firm's carbon productivity
* \(WatP_{it}\) = a proxy for a firm's water productivity
* \(WasP_{it}\) = a proxy for a firm's waste productivity
* \(GP_{it}\) = a proxy for a firm's green reputation
* \(SP_{it}\) = a proxy for a firm's sustainability pay link
* \(ST_{it}\) = a proxy for a firm's sustainability themed commitment
* \(EP_{it}\) = a proxy for a firm's audit score
* \(C_{it}\) = a vector of control variables that include financial leverage, firm size and industry sector
* \(\varepsilon_{it}\) = the error term


### Test

#### Tests of poolability

Citation from [@Croissant2008] :

> *pooltest tests the hypothesis that the same coeffcients apply to each individual. It is a standard F test, based on the comparison of a model obtained for the full sample and a model based on the estimation of an equation for each individual. The first argument of pooltest is a plm object. The second argument is a pvcm object obtained with model=within. If the first argument is a pooling model, the test applies to all the coefficients (including the intercepts), if it is a within model, different intercepts are assumed.*

```{r}
# Test of poolability --> Error that I do not understand

# M6_pvcm <- pvcm(ROA ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + GreenReputation + DebtRatio^2 + NetMargin + log(Asset), data=DB_Tobin, index=c("Companies", "YearFinancialIndicator"), model="within")

# M6_plm<-plm(ROA ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + GreenReputation + DebtRatio^2 + NetMargin + log(Asset), data=DB_Tobin, index=c("Companies", "YearFinancialIndicator"), model="within")

# pooltest(M6_pvcm,M6_plm)

# pooltest(ROA ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + GreenReputation + DebtRatio^2 + NetMargin + log(Asset), data=DB_Tobin, index=c("Companies", "YearFinancialIndicator"), model="within")
```

#### Fixed or Random : Hausman Test 

Citation from @Torres-Reyna2010 :

> *To decide between fixed or random effects you can run a Hausman test where the null hypothesis is that the preferred model is random effects vs. the alternative the fixed effects (see Green, 2008, chapter 9).  It basically tests whether the unique errors (ui) are correlated with the regressors, the null hypothesis is they are not.*


```{r}
fixed6 <- plm(ROA ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + GreenReputation + DebtRatio^2 + NetMargin + log(Asset), data=DB_Tobin, index=c("Companies", "YearFinancialIndicator"), model="within")

random6 <- plm(ROA ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + GreenReputation + DebtRatio^2 + NetMargin + log(Asset), data=DB_Tobin, index=c("Companies", "YearFinancialIndicator"), model = "random")

phtest(fixed6,random6)
```

**Interpretation :** P-Value < 0.05 then Ho is rejected and I have to use the fixed-effect.


#### Testing for time and companies fixed effects

```{r}

fixed_time6 <- plm(ROA ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + GreenReputation + DebtRatio^2 + NetMargin + log(Asset) + factor(YearFinancialIndicator), data = DB_Tobin, index=c("Companies", "YearFinancialIndicator"), model = "within")


# Testing the time-fixed effects. The null is that no time-fixed effects needed
pFtest(fixed_time6, fixed6)


```
**Interpretation Fixed_time effect :** P-Value is < 0.05 meaning that null hypothesis is rejected and that there is a significant time-fixed effect. **So I do need to use time fixed effect in this model!!**


#### Testing for cross-sectional dependence/contemporaneous correlation


Citation from @Torres-Reyna2010 :

> According to Baltagi, cross-sectional dependence is a problem in macro panels with long time series. This is not much of a problem in micro panels (few years and large number of cases). The null hypothesis in the B -P/LM and Pasaran CD tests of independence is that residuals across entities are not correlated. B-  P/LM and Pasaran CD (cross-sectional dependence) tests are used to test whether the residuals are correlated across entities*. Cross-sectional dependence can lead to bias in tests results (also called contemporaneous correlation). 


```{r}
pcdtest(fixed_time6, test = c("lm"))
pcdtest(fixed_time6, test = c("cd"))

pcdtest(fixed6, test = c("lm"))
pcdtest(fixed6, test = c("cd"))

```

HO is rejected as p-value < 0.05, namely the model do have cross-sectional dependence...


#### Testing for serial correlation

```{r}
pbgtest(fixed_time6)
pbgtest(fixed6)
```

**Interpretation:** HO is rejected as p-value < 0.05 then I have serial correlation....

#### Testing for stationarity

```{r}
if (!require("tseries")) install.packages("tseries")
library(tseries)
PanelSet <- plm.data(DB_Tobin, index = c("Companies", "YearFinancialIndicator"))
adf.test(PanelSet$TobinsQ, k=2)
```
Ho : Series has stationarity
**Interpretation :** p-value < 0.05 then ho is rejected and my panel data do not have stationarity


#### Testing for heteroskedasticity

```{r}
if (!require("lmtest")) install.packages("lmtest")
library(lmtest)

bptest(ROA ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + GreenReputation + DebtRatio^2 + NetMargin + log(Asset) + factor(Companies), data = DB_Tobin, studentize = F)

```
**Interpretation: ** p-value < 0.05 then the null hypothesis of homoskedasticity is rejected and heteroskedasticity assumed... 


Use the **sandwich estimator** to account for the heteroskedasticity issue? See @MiroshnychenkoGreenpracticesfinancial2017 and @Stock2008

"If hetersokedaticity is detected you can use the sandwich estimaror" [@Torres-Reyna2010]

vcovHC is a function for estimating a robust covariance matrix of parameters for a fixed effects or random effects panel model according to the White method (White 1980, 1984; Arellano 1987). The --vcovHC– function estimates three heteroskedasticity-consistent covariance estimators:

* "white1" - for general heteroskedasticity but no serial correlation. Recommended for random effects.

* "white2" - is "white1" restricted to a common variance within groups. Recommended for random effects.

* "arellano" - both heteroskedasticity and serial correlation. Recommended for fixed effects.


The following options apply*:

* HC0 - heteroskedasticity consistent. The default.
* HC1,HC2, HC3 – Recommended for small samples. HC3 gives less weight to influential observations.
* HC4 - small samples with influential observations 
* HAC - heteroskedasticity and autocorrelation consistent (type ?vcovHAC for more details)


```{r}
coeftest(fixed_time6) # Original coefficients 
coeftest(fixed_time6, vcovHC) # Heteroskedasticity consistent coefficients
coeftest(fixed_time6, vcovHC(fixed_time6, method = "arellano")) # Heteroskedasticity consistent
coeftest(fixed_time6, vcovHC(fixed_time6, type = "HC3")) # Heteroskedasticity consistent coefficients, type 3coefficients (Arellano)
# The following shows the HC standard errors of the coefficients
t(sapply(c("HC0", "HC1", "HC2", "HC3", "HC4"), function(x) sqrt(diag(vcovHC(fixed_time6, type = x)))))

coeftest(fixed6) # Original coefficients 
coeftest(fixed6, vcovHC) # Heteroskedasticity consistent coefficients
coeftest(fixed6, vcovHC(fixed6, method = "arellano")) # Heteroskedasticity consistent
coeftest(fixed6, vcovHC(fixed6, type = "HC3")) # Heteroskedasticity consistent coefficients, type 3coefficients (Arellano)
# The following shows the HC standard errors of the coefficients
t(sapply(c("HC0", "HC1", "HC2", "HC3", "HC4"), function(x) sqrt(diag(vcovHC(fixed6, type = x)))))
```


**What should I do with those estimates?**
