---
output: pdf_document
---

# DataBase TobinQ

I am gonna check if I have outliers in the dabase of my first dependent variable, namely Tobin's Q. 


```{r}
if (!require("utils")) install.packages("utils")
if (!require("car")) install.packages("car")
if (!require("dplyr")) install.packages("dplyr")

library(utils)
library(car)
library(dplyr)

# I dowload my DataBase with read.csv2
DB<-data.frame(read.csv2("Analysis/DataBase/DB_Tobin.csv", sep = ";",stringsAsFactors=FALSE, header = TRUE ))

# Let's measure the cook distance

## My model
M1_Tobin <-lm(TobinsQ~EnergyProductivity+CarbonProductivity+WaterProductivity+WasteProductivity+GreenReputation+SustainabilityPayLink+SustainableThemedCommitment+AuditScore+DebtRatio^2+NetMargin+log(Asset),data=DB)

## I calculate my cooks distance. Cook’s distance is a measure computed with respect to a given regression model and therefore is impacted only by the X variables included in the model. Cook’s distance computes the influence exerted by each data point (row) on the predicted outcome.

cooksd <- cooks.distance(M1_Tobin)


## I summarise on a graph, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential.

plot(cooksd, pch="*", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=T), col="red")  # add cutoff line
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=T),names(cooksd),""), col="red")  # add labels

##The following command find out the influential rows, namely rows where are the outliers of my BD

influential <- as.numeric(names(cooksd)[(cooksd > 4*mean(cooksd, na.rm=T))])  

## The function outlierTest from car package gives the most extreme observation based on the given model

car::outlierTest(M1_Tobin)
```

Deleting missing values of Tobins Q from my database equals to deleting ```r nrow(DB) - nrow(DB_tobin) ``` rows. Nine values are outliers in this data base. Let's remove them and repeat the process.

```{r}
DB_Tobin_NoOutliers <- DB_Tobin[-c(49,1050,1042,1017,459,496,956,248,997),]
# Let's measure the cook distance

## My model
M1_Tobin <-lm(TobinsQ~EnergyProductivity+CarbonProductivity+WaterProductivity+WasteProductivity+GreenReputation+SustainabilityPayLink+SustainableThemedCommitment+AuditScore+DebtRatio^2+NetMargin+log(Asset),data=DB_Tobin_NoOutliers)

## I calculate my cooks distance. Cook’s distance is a measure computed with respect to a given regression model and therefore is impacted only by the X variables included in the model. Cook’s distance computes the influence exerted by each data point (row) on the predicted outcome.

cooksd <- cooks.distance(M1_Tobin)

## I summarise on a graph, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential.

plot(cooksd, pch="*", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=T), col="red")  # add cutoff line
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=T),names(cooksd),""), col="red")  # add labels

##The following command find out the influential rows, namely rows where are the outliers of my BD

influential <- as.numeric(names(cooksd)[(cooksd > 4*mean(cooksd, na.rm=T))])  

## The function outlierTest from car package gives the most extreme observation based on the given model

car::outlierTest(M1_Tobin)

```

Still 10 outliers, let's repeat

```{r}

DB_Tobin_NoOutliers02 <- DB_Tobin_NoOutliers[-c(897,1019,904,534,819,874,407,648,431,140),]

# Let's measure the cook distance

## My model
M1_Tobin02 <-lm(TobinsQ~EnergyProductivity+CarbonProductivity+WaterProductivity+WasteProductivity+GreenReputation+SustainabilityPayLink+SustainableThemedCommitment+AuditScore+DebtRatio^2+NetMargin+log(Asset),data=DB_Tobin_NoOutliers02)

cooksd02 <- cooks.distance(M1_Tobin02)

car::outlierTest(M1_Tobin02)

```

**Why the same rows???**

# DataBase ROA



I have still 9 outliers, let's repeat again.
