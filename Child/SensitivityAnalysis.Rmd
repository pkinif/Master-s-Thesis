---
output:
  pdf_document
---

```{r include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, error = FALSE, warning = FALSE, results = 'asis')
```


```{r}

################################################
############## Package loading #################
################################################

rm(list=ls()) #Removes all items in the R environment
if (!require("plm")) install.packages("plm")
library(plm) 
if (!require("dplyr")) install.packages("dplyr")
library(dplyr) 
if (!require("data.table")) install.packages("data.table")
library(data.table)
if (!require("stargazer")) install.packages("stargazer")
library(stargazer)
```

# Sensitivity Analysis

Sensitivity Analysis investigates how the variation in the output of a numerical model can be attributed to variations of its input factors [@Pianosi2016]. To ensure the robustness of the main findings of the previous section I have carried out two robustness tests. 

Firstly the equation \ref{EconometricModel} had been re-estimated using dependent variables accelerated by one year in a sense that observations in independent and control variables are now lagged two year behind corporate financial performance. Based on the results of both Breusch Pagan Multiplier and F tests, estimators had been estimated with the *pooled ols estimation*. Results are reported in table \ref{Lag2} and confirms results of the previous section.

Secondly, I have used an alternative proxy for approaching corporate environmental performance, namely the Green Score assigned to each company of the NewsWeek Green Ranking. The score is based on a weighted average of the key performance indicators of the ranking. Concretely, it means that equation \ref{EconometricModel} becomes the following equation.

\begin{equation}
\centering
Y_{it+1} = \alpha + \beta_{1} GS_{it} + Controls_{it} + u_{it}
\label{GreenScoreEquation}
\end{equation}


where \(Y_{it+1}\) is a proxy of CFP measured as ROA or Tobin's Q, \(GS_{it}\) is a proxy for a firm's green score, \(Controls_{it}\) is a vector of control variables that includes firm size, industry sector, financial leverage and growth and lastly \(u_{it}\) which is the error term.

The model using TobinsQ as a proxy for CFP had been estimated with the *pooled ols estimators* while the model using Roa uses the *fixed effect estimation*. Results are reported in table \ref{GreenScoreResults} and confirms findings of the previous section. Consequently, the sensitivity analysis supports that CEP do have a significant and positive effect on CFP (short and long-term). 


\newpage
```{r}
################################################
######## The impact of CEP on CFP ##############
################################################

# I have already removed outliers from both model (i.e. Roa and TobinsQ) through the file = "Analysis/MakeFile_RemoveOutliers_Lag1.rmd". Consequently I just need to download them in this file.
RoaNoOut <- read.csv(file = "Analysis/DataBase/DataSynchronization/NoOutliersLag2/Roa.csv", header = TRUE, stringsAsFactors = FALSE)

TobinNoOut <- read.csv(file = "Analysis/DataBase/DataSynchronization/NoOutliersLag2/TobinsQ.csv", header = TRUE, stringsAsFactors = FALSE)
 
# I make both df a plm dataframe
RoaNoOut <- RoaNoOut %>% pdata.frame(index = c("CompaniesIndex", "YearIndex"))
TobinNoOut <- TobinNoOut %>% pdata.frame(index = c("CompaniesIndex", "YearIndex"))

# I test for Random Effect Model using the Lagrange Multiplier Tests for Panel Models. 

  ## Pooling Model
  RoaPooling <- plm(Roa ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + CarbonProductivity + WaterProductivity + WasteProductivity + FirmSize + FinancialLeverage + Growth + Industry, data = RoaNoOut, model="pooling")
  TobinPooling <- plm(TobinsQ ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + CarbonProductivity + WaterProductivity + WasteProductivity + FirmSize + FinancialLeverage + Growth + Industry, data = TobinNoOut, model="pooling")


  ## Plmtest
  PlmtestRoa <-as.numeric(round(plmtest(RoaPooling, effect = "time", type = "bp")$p.value, digits = 3))
  PlmtestTobin <-as.numeric(round(plmtest(TobinPooling, effect = "time", type = "bp")$p.value, digits = 3))

  ## Improve p-value understanding
  PlmtestRoa<-ifelse(PlmtestRoa<0.01, paste(PlmtestRoa,"***",sep = ""),
		ifelse(PlmtestRoa<0.05,paste(PlmtestRoa,"**",sep = ""),
		ifelse(PlmtestRoa<0.1,paste(PlmtestRoa,"*",sep = ""),PlmtestRoa)))
  PlmtestTobin<-ifelse(PlmtestTobin<0.01, paste(PlmtestTobin,"***",sep = ""),
		ifelse(PlmtestTobin<0.05,paste(PlmtestTobin,"**",sep = ""),
		ifelse(PlmtestTobin<0.1,paste(PlmtestTobin,"*",sep = ""),PlmtestTobin)))
  
# I test for Fixed Effect Model using pFtest which is a test of individual and/or time effects based on the comparison of the within and the pooling model.
  
  ## Within Model with time effect
  
  RoaWithin <- plm(Roa ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + CarbonProductivity + WaterProductivity + WasteProductivity + FirmSize + FinancialLeverage + Growth + Industry, data = RoaNoOut, model="within", effect = "time")
  TobinWithin <- plm(TobinsQ ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + CarbonProductivity + WaterProductivity + WasteProductivity + FirmSize + FinancialLeverage + Growth + Industry, data = TobinNoOut, model = "within", effect = "time")
  
  ## pFtest
  
  pFtestRoa <- as.numeric(round(pFtest(RoaWithin, RoaPooling)$p.value, digits = 3))
  pFtestTobin <- as.numeric(round(pFtest(TobinWithin, TobinPooling)$p.value, digits = 3))

  ## Improve p-value understanding
  pFtestRoa<-ifelse(pFtestRoa<0.01, paste(pFtestRoa, "***",sep = ""),
		ifelse(pFtestRoa<0.05,paste(pFtestRoa,"**",sep = ""),
		ifelse(pFtestRoa<0.1,paste(pFtestRoa,"*",sep = ""),pFtestRoa)))
  pFtestTobin<-ifelse(pFtestTobin<0.01, paste(pFtestTobin,"***",sep = ""),
		ifelse(pFtestTobin<0.05,paste(pFtestTobin,"**",sep = ""),
		ifelse(pFtestTobin<0.1,paste(pFtestTobin,"*",sep = ""),pFtestTobin)))
  
# Based on the results of the tests, the two models need to be estimated with the pooling ols estimations (i.e. model = "pooling" in plm). Let's consolidate into a nice stargazer table
  
stargazer(TobinPooling, RoaPooling, title = "The impact of both process-based and outcome-based CEP on CFP (lag = 2)", label = "Lag2", header = FALSE, type = "latex", align = FALSE, model.numbers = FALSE, table.placement = "!", add.lines = list(c("BPLM test (pvalue)", PlmtestTobin, PlmtestRoa),
                           c("F test (pvalue)", pFtestTobin ,pFtestRoa)))

```


\newpage
```{r}
################################################
###### GreenScore as an alternative ############
################################################

# I have already removed outliers from both model (i.e. Roa and TobinsQ) through the file = "Analysis/MakeFile_RemoveOutliers_Lag1.rmd". Consequently I just need to download them in this file.
RoaNoOut <- read.csv(file = "Analysis/DataBase/DataSynchronization/NoOutliersLag1/GreenScore/Roa.csv", header = TRUE, stringsAsFactors = FALSE)

TobinNoOut <- read.csv(file = "Analysis/DataBase/DataSynchronization/NoOutliersLag1/GreenScore/TobinsQ.csv", header = TRUE, stringsAsFactors = FALSE)
 
# I make both df a plm dataframe
RoaNoOut <- RoaNoOut %>% pdata.frame(index = c("CompaniesIndex", "YearIndex"))
TobinNoOut <- TobinNoOut %>% pdata.frame(index = c("CompaniesIndex", "YearIndex"))

# I test for Random Effect Model using the Lagrange Multiplier Tests for Panel Models. 

  ## Pooling Model
  RoaPooling <- plm(Roa ~ GreenScore + FirmSize + FinancialLeverage + Growth + Industry, data = RoaNoOut, model="pooling")
  TobinPooling <- plm(TobinsQ ~ GreenScore + FirmSize + FinancialLeverage + Growth + Industry, data = TobinNoOut, model="pooling")


  ## Plmtest
  PlmtestRoa <- as.numeric(round(plmtest(RoaPooling, effect = "time", type = "bp")$p.value, digits = 3))
  PlmtestTobin <- as.numeric(round(plmtest(TobinPooling, effect = "time", type = "bp")$p.value, digits = 3))

  ## Improve p-value understanding
  PlmtestRoa<-ifelse(PlmtestRoa<0.01, paste(PlmtestRoa,"***",sep = ""),
		ifelse(PlmtestRoa<0.05,paste(PlmtestRoa,"**",sep = ""),
		ifelse(PlmtestRoa<0.1,paste(PlmtestRoa,"*",sep = ""), PlmtestRoa)))
  PlmtestTobin<-ifelse(PlmtestTobin<0.01, paste(PlmtestTobin,"***",sep = ""),
		ifelse(PlmtestTobin<0.05,paste(PlmtestTobin,"**",sep = ""),
		ifelse(PlmtestTobin<0.1,paste(PlmtestTobin,"*",sep = ""),PlmtestTobin)))
  
# I test for Fixed Effect Model using pFtest which is a test of individual and/or time effects based on the comparison of the within and the pooling model.
  
  ## Within Model with time effect
  
  RoaWithin <- plm(Roa ~ GreenScore + FirmSize + FinancialLeverage + Growth + Industry, data = RoaNoOut, model = "within", effect = "time")
  TobinWithin <- plm(TobinsQ ~ GreenScore + FirmSize + FinancialLeverage + Growth + Industry, data = TobinNoOut, model = "within", effect = "time")
  
  ## pFtest
  
  pFtestRoa <- as.numeric(round(pFtest(RoaWithin, RoaPooling)$p.value, digits = 3))
  
  pFtestTobin <- as.numeric(round(pFtest(TobinWithin, TobinPooling)$p.value, digits = 3))
  
  ## Improve p-value understanding
  pFtestRoa<-ifelse(pFtestRoa<0.01, paste(pFtestRoa,"***",sep = ""),
		ifelse(pFtestRoa<0.05,paste(pFtestRoa,"**",sep = ""),
		ifelse(pFtestRoa<0.1,paste(pFtestRoa,"*",sep = ""),pFtestRoa)))
  pFtestTobin<-ifelse(pFtestTobin<0.01, paste(pFtestTobin,"***",sep = ""),
		ifelse(pFtestTobin<0.05,paste(pFtestTobin,"**",sep = ""),
		ifelse(pFtestTobin<0.1,paste(pFtestTobin,"*",sep = ""),pFtestTobin)))

# Let's consolidate into a stargazer table
  
stargazer(TobinPooling, RoaWithin, title = "GreenScore - an alternative variable for CEP", label = "GreenScoreResults", header = FALSE, type = "latex", align = FALSE, model.numbers = FALSE, table.placement = "!", add.lines = list(c("BPLM test (pvalue)", PlmtestTobin, PlmtestRoa),
                           c("F test (pvalue)", pFtestTobin ,pFtestRoa)))


```

