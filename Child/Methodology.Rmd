---
output:
  pdf_document
---

# Methodology

Here is my methodology...

## Panel Data

### Definition of panel data

Panel data, also called longitudinal data or cross-sectional time-series data include observations on N cross section units (i.e., firms) over T time-periods. 

### Advantages of panel data :

As panel data analysis uses variation in both these dimensions, it is considered to be one of the most efficient analytical methods for data [@DimitriosAsteriou2006]. It usually contains more degrees of freedom, less collinearity among the variables, more efficiency and more sample variability than one-dimensional method (i.e.cross-sectional data and time series data) giving a more accurate inference of the parameters estimated in the model [@Hsiao2007, @HsiaoChapitrePanelData2014].

### Fixed or random effect model

Panel data may have individual (group) effect, time effect, or both, which are analyzed by fixed effect and/or random effect models. *A fixed effect model* examines if intercepts vary across group or time period, whereas a *random effect model* explores differences in error variance components across individual or time period. [@Park2011].



**!! I need to test the fixed-random effect model of my database before moving forward !!**

<!----> 
* @Ng2015 used the two-stage-least-square regressions to estimate its models. 

** In case of presence of endogeneyity in an econometric model,  OLS is not capable of delivering consistent parameter estimates [@Wooldridge2008].**

Citation from [@Wooldridge2008] :

> The general concept is that of the instrumental variables estimator;  a  popular  form  of  that  estimator, often employed in the context of endogeneity, is known as two-stage least squares (2SLS)


### Endogeneity test

Even if panel data have a lot of advantages...


Two issues involved in utilizing panel data, namely heterogeneity bias and selectivity bias [@HsiaoChapitrePanelData2014].

Citation from @HsiaoChapitrePanelData2014:

> It is only by taking proper account of selectivity and heterogeneity biases in the panel data that one can have confidence in the results obtained.

@Dangsearchrobustmethods2015 examine which methods are appropriate for estimating dynamic panel data models in empirical corporate finance,especially in short panels of company data, in the likely presence of (1) unobserved heterogeneity and endogeneity, (2) residual serial correlation, or (3) fractional dependent variables. The bias-corrected fixed-effects estimators, based on an analytical, bootstrap, or indirect inference approach, are found to be the most appropriate and robust methods. 

But @MiroshnychenkoGreenpracticesfinancial2017 used the OLS regressions in micro panel using the Huber-White sand
which estimator, to account for the heteroscedasticity problem... **Which method should I use?**


Hausmann test to test the random effects model for both dependent variables?


\newpage

## Econometric Model

The first hypothesis will be tested with T-tests on the impact of each green initiative on green performance.

Hypotheses two and three will be tested by regression analysis using the *plm* package. Econometric models are based on @Delmas2015 and @MiroshnychenkoGreenpracticesfinancial2017 and started from the general form:

\begin{equation}
Y_{t+1}=\beta_{0} + \beta_{1} (X_{it}) + + \beta_{2} (C_{it}) + \varepsilon_{it}
\label{GeneralForm}
\end{equation}

where \(Y_{t+1}\) is the financial performance of firm \(i\) in year \(t+1\), \(\beta\) is the vector of estimated regression coefficients for each of the explanatory variables \(X_{it}\), \(C_{it}\) is a vector of control variables , \(\varepsilon_{it}\) is the error term.

More precisely I will regress six models :


**Model 1 :** Green Initiatives on Tobin's Q

\begin{equation}
TobinsQ_{it+1} = \beta_{0} + \beta_{1} (SP_{it}) + \beta_{2} (ST_{it}) + \beta_{3} (AS_{it}) + \beta_{4} (C_{it}) + \varepsilon_{it}
\label{M1}
\end{equation}


**Model 2 :** Green Initiatives on ROA

\begin{equation}
ROA_{it+1} = \beta_{0} + \beta_{1} (SP_{it}) + \beta_{2} (ST_{it}) + \beta_{3} (AS_{it}) + \beta_{4} (C_{it}) + \varepsilon_{it}
\label{M2}
\end{equation}


**Model 3 :** Green Performance on Tobin's Q

\begin{equation}
TobinsQ_{it+1} = \beta_{0} + \beta_{1} (EP_{it}) + \beta_{2} (CP_{it}) + \beta_{3} (WatP_{it}) + \beta_{4} (WasP_{it}) + \beta_{5} (C_{it}) + \varepsilon_{it}
\label{M3}
\end{equation}


**Model 4 :** Green Performance on ROA

\begin{equation}
ROA_{it+1} = \beta_{0} + \beta_{1} (EP_{it}) + \beta_{2} (CP_{it}) + \beta_{3} (WatP_{it}) + \beta_{4} (WasP_{it}) + \beta_{5} (C_{it}) + \varepsilon_{it}
\label{M4}
\end{equation}


**Model 5 :** Both Green Performance and Green Initiative on Tobin's Q

\begin{equation}
TobinsQ_{it+1} = \beta_{0} + \beta_{1} (EP_{it}) + \beta_{2} (CP_{it}) + \beta_{3} (WatP_{it}) + \beta_{4} (WasP_{it})  + \beta_{5} (SP_{it}) + \beta_{6} (ST_{it}) + \beta_{7} (AS_{it})+ (C_{it}) + \varepsilon_{it}
\label{M5}
\end{equation}


**Model 6 :** Both Green Performance and Green Initiative on ROA

\begin{equation}
ROA_{it+1} = \beta_{0} + \beta_{1} (EP_{it}) + \beta_{2} (CP_{it}) + \beta_{3} (WatP_{it}) + \beta_{4} (WasP_{it})  + \beta_{5} (SP_{it}) + \beta_{6} (ST_{it}) + \beta_{7} (AS_{it})+ (C_{it}) + \varepsilon_{it}
\label{M6}
\end{equation}


where :

* \(TobinsQ_{it+1}\) = a proxy for a firm's financial performance
* \(ROA_{it+1}\) = a proxy for a firm's financial performance
* \(EP_{it}\) = a proxy for a firm's energy productivity
* \(CP_{it}\) = a proxy for a firm's carbon productivity
* \(WatP_{it}\) = a proxy for a firm's water productivity
* \(WasP_{it}\) = a proxy for a firm's waste productivity
* \(SP_{it}\) = a proxy for a firm's sustainability pay link
* \(ST_{it}\) = a proxy for a firm's sustainability themed commitment
* \(EP_{it}\) = a proxy for a firm's audit score
* \(C_{it}\) = a vector of control variables that include financial leverage, firm size, net margin and industry sector
* \(\varepsilon_{it}\) = the error term



\newpage
## Panel Data Tests

```{r echo =FALSE, message = FALSE, error = FALSE}
if (!require("dplyr")) install.packages("dplyr")
library(dplyr)
# I download my database for each Dependent Variable
DB_Roa<-data.frame(read.csv2("Analysis/DataBase/DataBase_010418.csv", sep = ";",stringsAsFactors=FALSE, header = TRUE ))
DB_Tobin <- filter(DB_Roa, !is.na(TobinsQ))

```


This section will not be in the final document. It is only to report the result of the bunch of tests I carried out in order to define which panel data methotolodies I will use for each one of my 6 models.

@Croissant2008a and @Torres-Reyna2010 really helped me.

Here are the tests : 

1. Test of poolability 
2. Hausmann Test to determine the fixed or random effect
3. Test for time fixed effect
4. Test for cross-sectional dependence
5. Test for serial correlation
6. Test for stationarity
7. Test for heteroskedasticity

The table \ref{TestSummary} summaries the result of each test for each model. You can find details below.

Regarding the poolability test I have an issue with my code that I still need to solve. This is why it is written *NA* in the table \ref{TestSummary}. I have also an issue with the test for cross-sectionnal dependence. Indeed depending the method I use with the test syntax (i.e. Pesaran's CD test (test="cd") or Breusch and Pagan's LM test (test="lm"), I got divergent results. **Do you know why? Which one suit the best my model?**


\begin{table}[h]
\centering
\begin{tabular}{rrrrrrr}
\hline
 & {Model 1} & {Model 2} & {Model 3} & {Model 4} & {Model 5} & {Model 6} \\ 
\hline
{Poolability} & NA & NA & NA & NA & NA & NA \\
{Hausmann} & Fixed & Fixed & Fixed & Fixed & Fixed & Fixed \\
{Time Fixed Effect} & No & Yes & No & Yes & No & Yes \\
{Cross Sectional Dependence} & ? & Yes & ? & ? & ? & Yes \\
{Serial Correlation} & Yes & Yes & Yes & Yes & Yes & Yes \\
{Stationarity} & None & None & None & None & None & None \\
{Heteroskedasticity} & Yes & Yes & Yes & Yes & Yes & Yes \\ 
\hline
\end{tabular}
\caption{Test Summary}
\label{TestSummary}
\end{table}

\newpage
### Test of poolability 

Citation from [@Croissant2008] :

> *Pooltest tests the hypothesis that the same coefficients apply to each individual. It is a standard F test, based on the comparison of a model obtained for the full sample and a model based on the estimation of an equation for each individual. The first argument of pooltest is a plm object. The second argument is a pvcm object obtained with model=within. If the first argument is a pooling model, the test applies to all the coefficients (including the intercepts), if it is a within model, different intercepts are assumed.*

The null hypothesis of poolability assumes homogeneous slope coefficients.

When running my code I got this error : Error in FUN(X[[i]], ...) : insufficient number of observations

I still need to understand the origin of this error.


```{r echo = FALSE, message = FALSE, error = FALSE}
if (!require("plm")) install.packages("plm")
library(plm)

# Test of poolability --> error that I cannot understand

# PVCM regression
#M1_pvcm <- pvcm(TobinsQ ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + Leverage + NetMargin + FirmSize + Industry, data=DB_Tobin, index=c("Companies", "YearFinancialIndicator"), model="within")

#M2_pvcm <- pvcm(ROA ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + Leverage + NetMargin + FirmSize + Industry, data=DB_Roa, index=c("Companies", "YearFinancialIndicator"), model="within")

#M3_pvcm <- pvcm(TobinsQ ~ EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + Leverage + NetMargin + FirmSize + Industry, data=DB_Tobin, index=c("Companies", "YearFinancialIndicator"), model="within")

#M4_pvcm <- pvcm(ROA ~ EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + Leverage + NetMargin + FirmSize + Industry, data=DB_Roa, index=c("Companies", "YearFinancialIndicator"), model="within")

#M5_pvcm <- pvcm(TobinsQ ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + Leverage + NetMargin + FirmSize + Industry, data=DB_Tobin, index=c("Companies", "YearFinancialIndicator"), model="within")

#M6_pvcm <- pvcm(ROA ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + Leverage + NetMargin + FirmSize + Industry, data=DB_Roa, index=c("Companies", "YearFinancialIndicator"), model="within")

# PLM regression
M1_plm <- plm(TobinsQ ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + Leverage + NetMargin + FirmSize + Industry, data=DB_Tobin, index=c("Companies", "YearFinancialIndicator"), model="within")

M2_plm <- plm(ROA ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + Leverage + NetMargin + FirmSize + Industry, data=DB_Roa, index=c("Companies", "YearFinancialIndicator"), model="within")

M3_plm <- plm(TobinsQ ~ EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + Leverage + NetMargin + FirmSize + Industry, data=DB_Tobin, index=c("Companies", "YearFinancialIndicator"), model="within")

M4_plm <- plm(ROA ~ EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + Leverage + NetMargin + FirmSize + Industry, data=DB_Roa, index=c("Companies", "YearFinancialIndicator"), model="within")

M5_plm <- plm(TobinsQ ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + Leverage + NetMargin + FirmSize + Industry, data=DB_Tobin, index=c("Companies", "YearFinancialIndicator"), model="within")

M6_plm <- plm(ROA ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + Leverage + NetMargin + FirmSize + Industry, data=DB_Roa, index=c("Companies", "YearFinancialIndicator"), model="within")

#PoolTest

#pooltest(M1_pvcm,M1_plm)
#pooltest(M2_pvcm,M2_plm)
#pooltest(M3_pvcm,M3_plm)
#pooltest(M4_pvcm,M4_plm)
#pooltest(M5_pvcm,M5_plm)
#pooltest(M6_pvcm,M6_plm)

```

### Hausmann Test to determine the fixed or random effect

Citation from @Torres-Reyna2010 :

> *To decide between fixed or random effects you can run a Hausman test where the null hypothesis is that the preferred model is random effects vs. the alternative the fixed effects (see Green, 2008, chapter 9).  It basically tests whether the unique errors (ui) are correlated with the regressors, the null hypothesis is they are not.*

```{r echo = FALSE, error = FALSE, message = FALSE, results = 'asis'}
if (!require("stargazer")) install.packages("stargazer")
library(stargazer)

if (!require("xtable")) install.packages("xtable")
library(xtable)

# Fixed Model

Fixed1 <- plm(TobinsQ ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + Leverage + NetMargin + FirmSize + Industry, data=DB_Tobin, index=c("Companies", "YearFinancialIndicator"), model="within")

Fixed2 <- plm(ROA ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + Leverage + NetMargin + FirmSize + Industry, data=DB_Roa, index=c("Companies", "YearFinancialIndicator"), model="within")

Fixed3 <- plm(TobinsQ ~ EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + Leverage + NetMargin + FirmSize + Industry, data=DB_Tobin, index=c("Companies", "YearFinancialIndicator"), model="within")

Fixed4 <- plm(ROA ~ EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + Leverage + NetMargin + FirmSize + Industry, data=DB_Roa, index=c("Companies", "YearFinancialIndicator"), model="within")

Fixed5 <- plm(TobinsQ ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + Leverage + NetMargin + FirmSize + Industry, data=DB_Tobin, index=c("Companies", "YearFinancialIndicator"), model="within")

Fixed6 <- plm(ROA ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + Leverage + NetMargin + FirmSize + Industry, data=DB_Roa, index=c("Companies", "YearFinancialIndicator"), model="within")

# Random Model

Random1 <- plm(TobinsQ ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + Leverage + NetMargin + FirmSize + Industry, data=DB_Tobin, index=c("Companies", "YearFinancialIndicator"), model="random")

Random2 <- plm(ROA ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + Leverage + NetMargin + FirmSize + Industry, data=DB_Roa, index=c("Companies", "YearFinancialIndicator"), model="random")

Random3 <- plm(TobinsQ ~ EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + Leverage + NetMargin + FirmSize + Industry, data=DB_Tobin, index=c("Companies", "YearFinancialIndicator"), model="random")

Random4 <- plm(ROA ~ EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + Leverage + NetMargin + FirmSize + Industry, data=DB_Roa, index=c("Companies", "YearFinancialIndicator"), model="random")

Random5 <- plm(TobinsQ ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + Leverage + NetMargin + FirmSize + Industry, data=DB_Tobin, index=c("Companies", "YearFinancialIndicator"), model="random")

Random6 <- plm(ROA ~ SustainabilityPayLink + SustainableThemedCommitment + AuditScore + EnergyProductivity + CarbonProductivity + WaterProductivity + WasteProductivity + Leverage + NetMargin + FirmSize + Industry, data=DB_Roa, index=c("Companies", "YearFinancialIndicator"), model="random")

# Hausmann Test

ColNames <- cbind("Model", "P_Value")
Hausman1 <- cbind("Model 1",phtest(Fixed1,Random1)$p.value)
Hausman2 <- cbind("Model 2",phtest(Fixed2,Random2)$p.value)
Hausman3 <- cbind("Model 3",phtest(Fixed3,Random3)$p.value)
Hausman4 <- cbind("Model 4",phtest(Fixed4,Random4)$p.value)
Hausman5 <- cbind("Model 5",phtest(Fixed5,Random5)$p.value)
Hausman6 <- cbind("Model 6",phtest(Fixed6,Random6)$p.value)

HausmanTable <- rbind(Hausman1, Hausman2, Hausman3, Hausman4, Hausman5, Hausman6)
colnames(HausmanTable) <- c("Model","P-Value")

#xtable(HausmanTable, caption = "Hausman Test Result", label = "Hausman", align = "rrr")

stargazer(HausmanTable, summary = FALSE, table.placement = "h", type="latex", label = "Hausman", title = "Hausman Test PValue", header = FALSE)

```

\newpage
## Sensitivity Analysis